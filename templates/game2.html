<html lang="en">

<head>
  <script type="text/javascript" src="../static/game.js"></script>

  <meta charset="utf-8">

  <title>Musical Chairs</title>
  <meta name="description" content="Figma htmlGenerator">
  <meta name="author" content="htmlGenerator">
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">

  <link rel="shortcut icon" href="#">

  <link rel="stylesheet" href="../static/game.css">

  <style>
    /*
                Figma Background for illustrative/preview purposes only.
                You can remove this style tag with no consequence
              */
    body {
      background: #E5E5E5;
    }
  </style>

  <script type="text/javascript">
    var A;
    var B;
    var C; 
    var D;

    // Chrome doesn't let audio autoplay anymore so users basically need to click somewhere on screen before audio can play. Stupid Google. 
    function startGame(){
      alert("Click here to begin the game.");
    }

    // Source: https://stackoverflow.com/questions/4959975/generate-random-number-between-two-numbers-in-javascript
    function randomIntFromInterval(min, max) { // min and max included 
      return Math.floor(Math.random() * (max - min + 1) + min)
    }

    /* Chrome and most other browsers disabled sound autoplay a couple years ago, so it is now necessary for the user to input in some way before sound gets played.
       This just handles that first play, the remaining ones get run during setAnswers so that the new sound plays once the new answers get presented. 
    */
    function firstPlay() {
      var audio = document.getElementById("my_audio");
      console.log(audio);
      audio.load();
      audio.play();
      audio.loop = false;
      document.body.removeEventListener('click', firstPlay);
    }

    function setAnswers() {
      var row = randomIntFromInterval(0, 38); // Grab the CSV row the player will be asked. 
      
      // These values will be used to make sure that we don't make two buttons the same answer.
      var assignedCorrect = false;
      var assignedIncorrect1 = false;
      var assignedIncorrect2 = false;
      var assignedIncorrect3 = false;
      var completeButtons = []; // This array will house the button IDs (0, 1, 2, 3) for the buttons we've added. So if A and C are done, this will be [0, 2]. 
      
      var audio_src; // We need to save the audio source file. 

      fetch("../static/songs.json")
      .then(response => {
        return response.json();
      })
      .then(data => {
        console.log(data[row])
        // Randomly generate a number between 0 and 3. 
        // If the first number is two, then A = Incorrect 2. 

        let i = 0; // This will count how many times we have added a button. 
        while (i != 4){
          var value = randomIntFromInterval(0, 3); // Correct = 0, Incorrect1 = 1, Incorrect2 = 2, Incorrect3 = 3
          if (completeButtons.includes(value)){ // If the button has already been assigned
            ; // Do nothing, get a new value 
          }

          else { // Else
            if (assignedCorrect == false){ // First value generated is going to be the correct button
              if (value == 0){
                document.getElementById('A').innerHTML = data[row].Correct;
                completeButtons.push(0);
              }

              else if (value == 1){
                document.getElementById('B').innerHTML = data[row].Correct;
                completeButtons.push(1);
              }

              else if (value == 2){
                document.getElementById('C').innerHTML = data[row].Correct;
                completeButtons.push(2);
              }

              else if (value == 3){
                document.getElementById('D').innerHTML = data[row].Correct;
                completeButtons.push(3);
              }
              
              assignedCorrect = true;
              i++;
            }
            
            else if (assignedIncorrect1 == false){
              if (value == 0){
                document.getElementById('A').innerHTML = data[row]["Incorrect 1"];
                completeButtons.push(0);
              }

              else if (value == 1){
                document.getElementById('B').innerHTML = data[row]["Incorrect 1"];
                completeButtons.push(1);
              }

              else if (value == 2){
                document.getElementById('C').innerHTML = data[row]["Incorrect 1"];
                completeButtons.push(2);
              }

              else if (value == 3){
                document.getElementById('D').innerHTML = data[row]["Incorrect 1"];
                completeButtons.push(3);
              }

              assignedIncorrect1 = true;
              i++;
            }

            else if (assignedIncorrect2 == false){
              if (value == 0){
                document.getElementById('A').innerHTML = data[row]["Incorrect 2"];
                completeButtons.push(0);
              }

              else if (value == 1){
                document.getElementById('B').innerHTML = data[row]["Incorrect 2"];
                completeButtons.push(1);
              }

              else if (value == 2){
                document.getElementById('C').innerHTML = data[row]["Incorrect 2"];
                completeButtons.push(2);
              }

              else if (value == 3){
                document.getElementById('D').innerHTML = data[row]["Incorrect 2"];
                completeButtons.push(3);
              }

              assignedIncorrect2 = true;
              i++;
            }

            else if (assignedIncorrect3 == false){
              if (value == 0){
                document.getElementById('A').innerHTML = data[row]["Incorrect 3"];
                completeButtons.push(0);
              }

              else if (value == 1){
                document.getElementById('B').innerHTML = data[row]["Incorrect 3"];
                completeButtons.push(1);
              }

              else if (value == 2){
                document.getElementById('C').innerHTML = data[row]["Incorrect 3"];
                completeButtons.push(2);
              }

              else if (value == 3){
                document.getElementById('D').innerHTML = data[row]["Incorrect 3"];
                completeButtons.push(3);
              }

              assignedIncorrect3 = true;
              i++;
            }
          }
        }

        var source = document.getElementById('audioSource');
        source.src = data[row]["Song URL"]
        var audio = document.getElementById("my_audio");
        audio.load()
        // Find a way to disable this if its the first song. 
        audio.play()
        //console.log(source.src)
      })

      return completeButtons; // The correct ordering of the buttons gets returned so that the onClick properly works!
    }
  </script>

</head>

<body>

  <div class=e4_16>
    <div class="e4_25"></div>
    <div class="e4_26"></div><span class="e4_27">B</span><span class="e4_28">bananainpajama7</span>
    <div class="e4_30"></div>
    <div class="e4_31"></div>
    <div class="e4_32"></div>
    <div class="e6_33"></div>
    <div class="e6_34"></div>
    <div class="e6_37"></div>
    <div class="e6_39"></div>
    <div class="e6_44"></div>
    <div class="e6_46"></div>
    <div class="e6_47"></div>
    <div class="e6_48"></div>
    <div class="e6_49"></div>
    <div class="e6_50"></div>
    <div class="e6_51"></div>
    <div class="e6_52"></div>
    <div class="e6_59"></div>
    <div class="e6_61"></div>
    <div class="e6_62"></div>
    <div class="e6_64"></div>
    <div class="e6_67"></div>
    <div class="e6_68"></div>
    <div class="e6_69"></div>
    <div class="e6_70"></div><span class="e6_71">17.57</span>
    <div class="e6_72"></div><span class="e6_75"></span><span class="e6_74"></span>
    <div class="e6_92"></div><span class="e6_93"></span><span class="e6_94"></span>
    <div class="e6_86"></div><span class="e6_87"></span><span class="e6_88"></span>
    <div class="e6_80"></div><span class="e6_81"></span><span class="e6_82"></span>

    <div class="scorebox"></div>
    <span id="questionsRemaining" class="questionsRemaining">1 / 10</span>
    <span id="score" class="score">0</span>
    <span id = "answerKey"></span>

    <audio src="" id="audio" loop="loop"></audio>

    <button class="buttonAsquare" onclick="correct(answerKey);"></button>
    <span class="buttonAanswer" span style="font-size: 200%"><span id="A"></span></span>
    <span class="buttonAa">A.</span>

    <button class="buttonBsquare" onclick="wrong(answerKey);"></button>
    <span class="buttonBanswer" span style="font-size: 200%"><span id="B"></span></span>
    <span class="buttonBb">B.</span>

    <button class="buttonCsquare" onclick="wrong(answerKey);"></button>
    <span class="buttonCanswer" span style="font-size: 200%"><span id="C"></span></span>
    <span class="buttonCc">C.</span>

    <button class="buttonDsquare" onclick="wrong(answerKey);"></button>
    <span class="buttonDanswer" span style="font-size: 200%"><span id="D"></span></span>
    <span class="buttonDd">D.</span>

    <audio id="my_audio" loop="loop">
      <source id="audioSource" src=""></source>
    </audio>

    <script>
      let answerKey;
      window.onload = function () {
        answerKey = setAnswers();
      }
      document.body.addEventListener('click', firstPlay);
    </script>

  </div>
</body>